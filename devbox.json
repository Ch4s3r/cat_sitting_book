{
  "$schema": "https://raw.githubusercontent.com/jetify-com/devbox/0.14.2/.schema/devbox.schema.json",
  "packages": [
    "nodejs@20",
    "tailscale"
  ],
  "shell": {
    "init_hook": [
      "if [ \"$CI\" = \"true\" ]; then echo '🔧 CI environment detected - using clean npm install'; npm install --no-fund --no-audit; elif [ ! -d node_modules ] || [ package-lock.json -nt node_modules ]; then echo '📦 Installing npm dependencies...'; npm ci --no-fund --no-audit; else echo '✅ npm dependencies already installed'; fi"
    ],
    "scripts": {
      "start": [
        "bash -c 'tailscale serve --bg 3000 && trap \"tailscale serve reset > /dev/null 2>&1\" EXIT && npm start'"
      ],
      "build": [
        "npm run build"
      ],
      "serve": [
        "npm run serve"
      ],
      "compress": [
        "mogrify -resize 700 static/img/*",
        "mogrify -quality 40 static/img/*",
        "du -h static/img"
      ],
      "test": [
        "echo '🏗️  Building Docusaurus...'",
        "npm run build",
        "echo '✅ Build successful! Now checking links...'",
        "echo '📝 Checking markdown links...'",
        "npx markdown-link-check docs/*.md --config .markdown-link-check.json",
        "echo '🖼️  Checking asset references...'",
        "node scripts/check-assets.js",
        "echo '🔗 Checking internal page links...'",
        "node scripts/check-internal-links.js",
        "echo '🎉 All tests passed!'"
      ]
    }
  }
}